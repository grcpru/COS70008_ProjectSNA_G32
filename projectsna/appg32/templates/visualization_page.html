<!DOCTYPE html>
<html>
<head>
    <title>Network Visualization</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis-network.min.css" rel="stylesheet" type="text/css">
    <style type="text/css">
        #mynetwork {
            width: 100%;
            height: 750px;
            border: 1px solid lightgray;
        }
    </style>
</head>
<body>
    <h1>Network Visualization</h1>
    <div>
        <label for="select-node">Select a Node by ID</label>
        <select id="select-node">
            <option value="">Select a node</option>
            {% for node in nodes %}
            <option value="{{ node.id }}">{{ node.label }}</option>
            {% endfor %}
        </select>
        
        <label for="select-group">Select a Community</label>
        <select id="select-group">
            <option value="">Select a Community</option>
            {% for group, group_nodes in grouped_nodes.items %}
            <option value="{{ group }}">{{ group }}</option>
            {% endfor %}
        </select>
        
        <button id="reset-selection">Reset Selection</button>
    </div>
    <div id="mynetwork"></div>
    <script type="text/javascript">
        // Store the original nodes and edges data
        var originalNodes = new vis.DataSet({{ nodes_json|safe }});
        var originalEdges = new vis.DataSet({{ edges_json|safe }});
 
        var nodes = new vis.DataSet({{ nodes_json|safe }});
        var edges = new vis.DataSet({{ edges_json|safe }});
 
        var container = document.getElementById('mynetwork');
        var data = {
            nodes: nodes,
            edges: edges
        };
        var options = {
            edges: {
                hoverWidth: function (edgeWidth) {
                    return Math.max(edgeWidth * 1.5, edgeWidth + 5);
                },
                color: {
                    highlight: '#ff0000'
                },
                font: {
                    color: '#000000',
                    size: 14,
                    face: 'arial'
                },
                smooth: {
                    type: 'dynamic'
                }
            },
            interaction: {
                hover: true,
                tooltipDelay: 300
            },
            physics: {
                enabled: true
            }
        };
        var network = new vis.Network(container, data, options);
 
        document.getElementById('select-node').addEventListener('change', function() {
            var nodeId = this.value;
            if (nodeId) {
                // Get connected nodes and edges
                var connectedNodes = network.getConnectedNodes(nodeId);
                connectedNodes.push(nodeId); // Include the selected node itself
 
                var connectedEdges = network.getConnectedEdges(nodeId);
 
                // Filter nodes and edges
                var newNodes = nodes.get({
                    filter: function(node) {
                        return connectedNodes.includes(node.id);
                    }
                });
 
                var newEdges = edges.get({
                    filter: function(edge) {
                        return connectedEdges.includes(edge.id);
                    }
                });
 
                // Update network with filtered data
                network.setData({
                    nodes: newNodes,
                    edges: newEdges
                });
            }
        });
 
        document.getElementById('select-group').addEventListener('change', function() {
            var groupId = this.value;
            if (groupId) {
                var selectedNodes = nodes.get({
                    filter: function(node) {
                        return node.group == groupId;
                    }
                });
                var selectedNodeIds = selectedNodes.map(function(node) { return node.id; });
 
                // Filter nodes and edges
                var newNodes = nodes.get({
                    filter: function(node) {
                        return selectedNodeIds.includes(node.id);
                    }
                });
 
                var newEdges = edges.get({
                    filter: function(edge) {
                        return selectedNodeIds.includes(edge.from) && selectedNodeIds.includes(edge.to);
                    }
                });
 
                // Update network with filtered data
                network.setData({
                    nodes: newNodes,
                    edges: newEdges
                });
            }
        });
 
        document.getElementById('reset-selection').addEventListener('click', function() {
            // Reset to original data
            nodes = new vis.DataSet(originalNodes.get());
            edges = new vis.DataSet(originalEdges.get());
            network.setData({
                nodes: nodes,
                edges: edges
            });
        });
    </script>
</body>
</html>